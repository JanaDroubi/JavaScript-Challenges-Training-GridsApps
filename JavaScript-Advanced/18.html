<!DOCTYPE html>
<html>
<head><title>Challenge 18: Invoice to JSON</title></head>
<body>
<h1>Convert Invoice Object to JSON</h1>
<button onclick="createInvoice()">Create & Convert Invoice</button>
<button onclick="showCode()">Show Code</button>
<div id="result"></div>
<div id="code" style="display:none; background:#f5f5f5; padding:10px;"></div>
<script>
function createInvoice() {
    let invoice = {
        id: "INV-2024-001",
        date: new Date(),
        customer: {
            name: "John Smith",
            email: "john@example.com"
        },
        items: [
            {name: "Laptop", quantity: 1, price: 999.99},
            {name: "Mouse", quantity: 2, price: 25.50},
            {name: "Keyboard", quantity: 1, price: 89.99}
        ],
        calculateTotal: function() {
            return this.items.reduce((sum, item) => 
                sum + (item.quantity * item.price), 0);
        },
        taxRate: 0.08
    };
    
    // Add calculated total
    invoice.total = invoice.calculateTotal();
    invoice.tax = invoice.total * invoice.taxRate;
    invoice.grandTotal = invoice.total + invoice.tax;
    
    // Convert to JSON (functions will be omitted)
    let json = JSON.stringify(invoice);
    let parsed = JSON.parse(json);
    
    document.getElementById('result').innerHTML = 
        `<strong>Invoice Object:</strong><br>
         ID: ${invoice.id}<br>
         Customer: ${invoice.customer.name}<br>
         Items: ${invoice.items.length}<br>
         Total: $${invoice.total.toFixed(2)}<br>
         Tax: $${invoice.tax.toFixed(2)}<br>
         Grand Total: $${invoice.grandTotal.toFixed(2)}<br><br>
         <strong>JSON String:</strong><br>
         Length: ${json.length} characters<br>
         First 100 chars: ${json.substring(0, 100)}...<br><br>
         <strong>After Parsing:</strong><br>
         Has calculateTotal function: ${'calculateTotal' in parsed ? 'No' : 'Yes (omitted)'}`;
    
    console.log('Invoice object:', invoice);
    console.log('JSON length:', json.length);
    console.log('JSON preview:', json.substring(0, 200));
}
function showCode() {
    document.getElementById('code').innerHTML = 
`let invoice = {
    id: "INV-001",
    date: new Date(),
    customer: {name: "John", email: "john@test.com"},
    items: [
        {name: "Item1", qty: 2, price: 10},
        {name: "Item2", qty: 1, price: 20}
    ],
    calculateTotal() {
        return this.items.reduce((sum, item) => sum + item.qty * item.price, 0);
    }
};

// Add calculated values
invoice.total = invoice.calculateTotal();
invoice.tax = invoice.total * 0.08;
invoice.grandTotal = invoice.total + invoice.tax;

// Convert to JSON
let json = JSON.stringify(invoice);
console.log('JSON length:', json.length);
console.log('JSON:', json);

// Note: calculateTotal function is omitted
let parsed = JSON.parse(json);
console.log('Has calculateTotal?', 'calculateTotal' in parsed); // false

// To include calculated values in JSON, compute them before stringify
invoice.total = invoice.calculateTotal(); // This is included
// But the function itself is not included`;
    document.getElementById('code').style.display = 'block';
}
</script>
</body>
</html>