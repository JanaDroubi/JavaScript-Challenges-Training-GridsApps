<!DOCTYPE html>
<html>
<head><title>Challenge 35: JSON to Graph Chart</title></head>
<body>
<h1>Convert JSON to Graph Chart (DOM only)</h1>
<button onclick="createBarChart()">Create Bar Chart</button>
<button onclick="createLineChart()">Create Line Chart</button>
<button onclick="createPieChart()">Create Pie Chart</button>
<button onclick="clearCharts()">Clear Charts</button>
<div id="chartContainer" style="margin:20px 0; padding:20px; background:#f5f5f5;"></div>
<div id="code" style="display:none; background:#f5f5f5; padding:10px;"></div>
<script>
// Sample data
const salesData = [
    { month: "Jan", sales: 1200, profit: 800 },
    { month: "Feb", sales: 1900, profit: 1200 },
    { month: "Mar", sales: 1500, profit: 900 },
    { month: "Apr", sales: 2200, profit: 1500 },
    { month: "May", sales: 1800, profit: 1100 },
    { month: "Jun", sales: 2500, profit: 1800 }
];

const categoryData = [
    { category: "Electronics", value: 35, color: "#4CAF50" },
    { category: "Clothing", value: 25, color: "#2196F3" },
    { category: "Books", value: 20, color: "#FF9800" },
    { category: "Home", value: 15, color: "#9C27B0" },
    { category: "Other", value: 5, color: "#607D8B" }
];

function createBarChart() {
    const container = document.getElementById('chartContainer');
    container.innerHTML = '<h3>Sales Bar Chart</h3>';
    
    // Create chart container
    const chart = document.createElement('div');
    chart.style.cssText = `
        display: flex;
        align-items: flex-end;
        height: 300px;
        border-bottom: 2px solid #333;
        border-left: 2px solid #333;
        padding: 20px 40px;
        gap: 40px;
    `;
    
    // Find max value for scaling
    const maxSales = Math.max(...salesData.map(d => d.sales));
    
    // Create bars
    salesData.forEach(data => {
        const barHeight = (data.sales / maxSales) * 250; // 250px max height
        
        const barContainer = document.createElement('div');
        barContainer.style.cssText = `
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
        `;
        
        const bar = document.createElement('div');
        bar.style.cssText = `
            width: 40px;
            height: ${barHeight}px;
            background: linear-gradient(to top, #4CAF50, #8BC34A);
            margin-top: auto;
            border-radius: 5px 5px 0 0;
            position: relative;
            transition: height 0.5s;
        `;
        
        // Add value label
        const valueLabel = document.createElement('div');
        valueLabel.textContent = `$${data.sales}`;
        valueLabel.style.cssText = `
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: bold;
        `;
        
        // Add month label
        const monthLabel = document.createElement('div');
        monthLabel.textContent = data.month;
        monthLabel.style.cssText = `
            margin-top: 5px;
            font-weight: bold;
        `;
        
        bar.appendChild(valueLabel);
        barContainer.appendChild(bar);
        barContainer.appendChild(monthLabel);
        chart.appendChild(barContainer);
    });
    
    // Add legend
    const legend = document.createElement('div');
    legend.style.cssText = `
        display: flex;
        gap: 20px;
        margin-top: 20px;
        justify-content: center;
    `;
    
    const salesLegend = document.createElement('div');
    salesLegend.innerHTML = `
        <div style="display:flex; align-items:center; gap:5px;">
            <div style="width:20px; height:20px; background:#4CAF50;"></div>
            <span>Sales</span>
        </div>
    `;
    
    legend.appendChild(salesLegend);
    
    container.appendChild(chart);
    container.appendChild(legend);
}

function createLineChart() {
    const container = document.getElementById('chartContainer');
    container.innerHTML = '<h3>Sales vs Profit Line Chart</h3>';
    
    // Create SVG-like chart using divs
    const chart = document.createElement('div');
    chart.style.cssText = `
        position: relative;
        height: 300px;
        border-bottom: 2px solid #333;
        border-left: 2px solid #333;
        padding: 20px 40px;
    `;
    
    // Find max value
    const maxValue = Math.max(
        ...salesData.map(d => d.sales),
        ...salesData.map(d => d.profit)
    );
    
    // Create grid lines
    for (let i = 0; i <= 5; i++) {
        const y = (i / 5) * 260; // 260px chart height
        const gridLine = document.createElement('div');
        gridLine.style.cssText = `
            position: absolute;
            left: 0;
            right: 0;
            top: ${y}px;
            border-top: 1px dashed #ddd;
            z-index: 0;
        `;
        
        const label = document.createElement('div');
        label.textContent = `$${Math.round((maxValue * (5 - i) / 5) / 100) * 100}`;
        label.style.cssText = `
            position: absolute;
            left: -40px;
            top: ${y - 10}px;
            font-size: 12px;
        `;
        
        chart.appendChild(gridLine);
        chart.appendChild(label);
    }
    
    // Create sales line
    createLine(salesData, 'sales', '#4CAF50', 'Sales', chart, maxValue);
    
    // Create profit line
    createLine(salesData, 'profit', '#2196F3', 'Profit', chart, maxValue);
    
    // Add month labels
    const monthContainer = document.createElement('div');
    monthContainer.style.cssText = `
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        padding: 0 40px;
    `;
    
    salesData.forEach(data => {
        const label = document.createElement('div');
        label.textContent = data.month;
        label.style.fontWeight = 'bold';
        monthContainer.appendChild(label);
    });
    
    container.appendChild(chart);
    container.appendChild(monthContainer);
    
    // Add legend
    const legend = document.createElement('div');
    legend.style.cssText = `
        display: flex;
        gap: 20px;
        margin-top: 20px;
        justify-content: center;
    `;
    
    ['Sales', 'Profit'].forEach((name, i) => {
        const color = i === 0 ? '#4CAF50' : '#2196F3';
        const item = document.createElement('div');
        item.innerHTML = `
            <div style="display:flex; align-items:center; gap:5px;">
                <div style="width:20px; height:3px; background:${color};"></div>
                <span>${name}</span>
            </div>
        `;
        legend.appendChild(item);
    });
    
    container.appendChild(legend);
}

function createLine(data, key, color, label, container, maxValue) {
    const points = [];
    const width = 500; // Chart width
    const height = 260; // Chart height
    
    // Create points
    data.forEach((item, i) => {
        const x = (i / (data.length - 1)) * width;
        const y = height - (item[key] / maxValue) * height;
        
        // Create point
        const point = document.createElement('div');
        point.style.cssText = `
            position: absolute;
            left: ${x}px;
            top: ${y}px;
            width: 8px;
            height: 8px;
            background: ${color};
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
        `;
        container.appendChild(point);
        
        points.push({ x, y });
    });
    
    // Create connecting lines
    for (let i = 0; i < points.length - 1; i++) {
        const p1 = points[i];
        const p2 = points[i + 1];
        
        const line = document.createElement('div');
        const length = Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));
        const angle = Math.atan2(p2.y - p1.y, p2.x - p1.x) * (180 / Math.PI);
        
        line.style.cssText = `
            position: absolute;
            left: ${p1.x}px;
            top: ${p1.y}px;
            width: ${length}px;
            height: 2px;
            background: ${color};
            transform-origin: 0 0;
            transform: rotate(${angle}deg);
            z-index: 1;
        `;
        
        container.appendChild(line);
    }
}

function createPieChart() {
    const container = document.getElementById('chartContainer');
    container.innerHTML = '<h3>Category Distribution Pie Chart</h3>';
    
    // Create pie chart container
    const chart = document.createElement('div');
    chart.style.cssText = `
        position: relative;
        width: 300px;
        height: 300px;
        margin: 0 auto;
        border-radius: 50%;
        overflow: hidden;
    `;
    
    // Calculate total
    const total = categoryData.reduce((sum, item) => sum + item.value, 0);
    
    // Create segments
    let currentAngle = 0;
    
    categoryData.forEach(item => {
        const percentage = (item.value / total) * 100;
        const angle = (percentage / 100) * 360;
        
        const segment = document.createElement('div');
        segment.style.cssText = `
            position: absolute;
            width: 100%;
            height: 100%;
            background: conic-gradient(
                ${item.color} 0deg ${angle}deg,
                transparent ${angle}deg 360deg
            );
            transform: rotate(${currentAngle}deg);
            border-radius: 50%;
        `;
        
        chart.appendChild(segment);
        
        // Add label
        const labelAngle = currentAngle + angle / 2;
        const radians = (labelAngle * Math.PI) / 180;
        const radius = 150;
        const labelX = Math.cos(radians) * (radius * 0.7) + radius;
        const labelY = Math.sin(radians) * (radius * 0.7) + radius;
        
        const label = document.createElement('div');
        label.textContent = `${item.category}: ${percentage.toFixed(1)}%`;
        label.style.cssText = `
            position: absolute;
            left: ${labelX}px;
            top: ${labelY}px;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: bold;
            background: white;
            padding: 2px 5px;
            border-radius: 3px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        `;
        
        chart.appendChild(label);
        
        currentAngle += angle;
    });
    
    // Add center circle
    const center = document.createElement('div');
    center.style.cssText = `
        position: absolute;
        width: 100px;
        height: 100px;
        background: white;
        border-radius: 50%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
    `;
    center.textContent = 'Total\n100%';
    center.style.whiteSpace = 'pre-line';
    center.style.textAlign = 'center';
    
    chart.appendChild(center);
    
    // Add legend
    const legend = document.createElement('div');
    legend.style.cssText = `
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        margin-top: 20px;
    `;
    
    categoryData.forEach(item => {
        const legendItem = document.createElement('div');
        legendItem.innerHTML = `
            <div style="display:flex; align-items:center; gap:5px;">
                <div style="width:15px; height:15px; background:${item.color}; border-radius:3px;"></div>
                <span>${item.category} (${item.value}%)</span>
            </div>
        `;
        legend.appendChild(legendItem);
    });
    
    container.appendChild(chart);
    container.appendChild(legend);
}

function clearCharts() {
    document.getElementById('chartContainer').innerHTML = '';
}

function showCode() {
    document.getElementById('code').innerHTML = 
`// Create bar chart from JSON data
function createBarChart(data, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    
    const maxValue = Math.max(...data.map(d => d.value));
    const chartHeight = 300;
    
    // Create chart
    const chart = document.createElement('div');
    chart.style.cssText = \`
        display: flex;
        align-items: flex-end;
        height: \${chartHeight}px;
        gap: 20px;
        border-bottom: 2px solid #333;
        padding: 20px;
    \`;
    
    // Create bars
    data.forEach(item => {
        const barHeight = (item.value / maxValue) * (chartHeight - 40);
        
        const barContainer = document.createElement('div');
        barContainer.style.cssText = \`
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
        \`;
        
        const bar = document.createElement('div');
        bar.style.cssText = \`
            width: 40px;
            height: \${barHeight}px;
            background: \${item.color || '#4CAF50'};
            border-radius: 5px 5px 0 0;
            margin-top: auto;
        \`;
        
        const label = document.createElement('div');
        label.textContent = item.label;
        label.style.marginTop = '5px';
        
        barContainer.appendChild(bar);
        barContainer.appendChild(label);
        chart.appendChild(barContainer);
    });
    
    container.appendChild(chart);
}

// Create line chart
function createLineChart(data, containerId) {
    const container = document.getElementById(containerId);
    const chart = document.createElement('div');
    chart.style.cssText = \`
        position: relative;
        height: 300px;
        border-bottom: 1px solid #333;
        border-left: 1px solid #333;
        padding: 20px;
    \`;
    
    // Calculate positions and draw lines
    // (Implementation similar to above)
    
    container.appendChild(chart);
}

// Create pie chart
function createPieChart(data, containerId) {
    const container = document.getElementById(containerId);
    const total = data.reduce((sum, item) => sum + item.value, 0);
    
    // Create pie using conic-gradient
    const pie = document.createElement('div');
    let gradientString = '';
    let accumulated = 0;
    
    data.forEach(item => {
        const percentage = (item.value / total) * 100;
        const start = accumulated;
        const end = accumulated + percentage;
        
        gradientString += \`\${item.color} \${start}% \${end}%, \`;
        accumulated = end;
    });
    
    pie.style.cssText = \`
        width: 200px;
        height: 200px;
        border-radius: 50%;
        background: conic-gradient(\${gradientString.slice(0, -2)});
        margin: 0 auto;
    \`;
    
    container.appendChild(pie);
}

// Fetch data and create chart
async function createChartFromAPI() {
    const response = await fetch('https://api.example.com/data');
    const jsonData = await response.json();
    
    // Transform API data for chart
    const chartData = jsonData.map(item => ({
        label: item.month,
        value: item.sales,
        color: '#4CAF50'
    }));
    
    createBarChart(chartData, 'chartContainer');
}

// Real-time chart updates
let chartInterval;
function startRealTimeChart(url, interval = 5000) {
    chartInterval = setInterval(async () => {
        const data = await fetchData(url);
        updateChart(data);
    }, interval);
}

function stopRealTimeChart() {
    clearInterval(chartInterval);
}

// Chart with tooltips
function createChartWithTooltips(data, containerId) {
    // Create chart elements
    // Add mouseover events to show tooltips
    const bars = document.querySelectorAll('.chart-bar');
    
    bars.forEach((bar, index) => {
        bar.addEventListener('mouseover', () => {
            showTooltip(data[index], bar);
        });
        
        bar.addEventListener('mouseout', () => {
            hideTooltip();
        });
    });
}

function showTooltip(data, element) {
    const tooltip = document.createElement('div');
    tooltip.textContent = \`\${data.label}: \${data.value}\`;
    tooltip.className = 'chart-tooltip';
    
    // Position tooltip near element
    const rect = element.getBoundingClientRect();
    tooltip.style.left = \`\${rect.left}px\`;
    tooltip.style.top = \`\${rect.top - 40}px\`;
    
    document.body.appendChild(tooltip);
}`;
    document.getElementById('code').style.display = 'block';
}
</script>
</body>
</html>