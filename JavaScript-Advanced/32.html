<!DOCTYPE html>
<html>
<head><title>Challenge 32: Search JSON Data</title></head>
<body>
<h1>Search in JSON Data from API</h1>
<input type="text" id="searchInput" placeholder="Search posts..." style="padding:10px; width:300px;">
<button onclick="searchPosts()">Search</button>
<button onclick="clearSearch()">Clear</button>
<button onclick="showCode()">Show Code</button>
<div id="searchResults" style="margin:20px 0;"></div>
<div id="code" style="display:none; background:#f5f5f5; padding:10px;"></div>
<script>
let allPosts = [];

// Fetch posts on page load
window.onload = async function() {
    try {
        const response = await fetch('https://jsonplaceholder.typicode.com/posts');
        allPosts = await response.json();
        document.getElementById('searchResults').innerHTML = 
            `<p>âœ… Loaded ${allPosts.length} posts. Start searching!</p>`;
        console.log('Posts loaded:', allPosts.length);
    } catch (error) {
        document.getElementById('searchResults').innerHTML = 
            `<p style="color:red">Error loading posts: ${error.message}</p>`;
    }
};

function searchPosts() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
    
    if (!searchTerm) {
        alert('Please enter a search term');
        return;
    }
    
    if (allPosts.length === 0) {
        alert('Posts not loaded yet. Please wait.');
        return;
    }
    
    // Search in title and body
    const results = allPosts.filter(post => 
        post.title.toLowerCase().includes(searchTerm) || 
        post.body.toLowerCase().includes(searchTerm)
    );
    
    displaySearchResults(results, searchTerm);
}

function displaySearchResults(results, searchTerm) {
    const container = document.getElementById('searchResults');
    
    if (results.length === 0) {
        container.innerHTML = `
            <div style="padding:20px; background:#fff3e0; border-radius:5px;">
                <h3>No results found for "${searchTerm}"</h3>
                <p>Try different search terms</p>
            </div>
        `;
        return;
    }
    
    let html = `
        <div style="padding:10px; background:#e8f5e9; border-radius:5px; margin-bottom:15px;">
            <h3>Found ${results.length} results for "${searchTerm}"</h3>
        </div>
    `;
    
    results.forEach(post => {
        // Highlight search term in results
        const highlightedTitle = highlightText(post.title, searchTerm);
        const highlightedBody = highlightText(post.body.substring(0, 150) + '...', searchTerm);
        
        html += `
            <div style="border:1px solid #ddd; padding:15px; margin:10px 0; background:white;">
                <h4 style="margin-top:0;">${highlightedTitle}</h4>
                <p>${highlightedBody}</p>
                <small style="color:#666;">Post ID: ${post.id} | User ID: ${post.userId}</small>
                <button onclick="viewPost(${post.id})" 
                        style="float:right; padding:5px 15px; background:#2196F3; color:white;">
                    View Details
                </button>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

function highlightText(text, term) {
    if (!term) return text;
    
    const regex = new RegExp(`(${term})`, 'gi');
    return text.replace(regex, '<mark>$1</mark>');
}

function viewPost(postId) {
    const post = allPosts.find(p => p.id === postId);
    if (post) {
        alert(`Post #${post.id}\n\nTitle: ${post.title}\n\nBody: ${post.body}`);
    }
}

function clearSearch() {
    document.getElementById('searchInput').value = '';
    document.getElementById('searchResults').innerHTML = 
        `<p>Enter a search term to find posts</p>`;
}

function showCode() {
    document.getElementById('code').innerHTML = 
`// Search in JSON data
async function searchInJSON(searchTerm) {
    try {
        // Fetch data
        const response = await fetch('https://jsonplaceholder.typicode.com/posts');
        const posts = await response.json();
        
        // Search in multiple fields
        const results = posts.filter(post => {
            return (
                post.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                post.body.toLowerCase().includes(searchTerm.toLowerCase()) ||
                post.id.toString().includes(searchTerm)
            );
        });
        
        return results;
        
    } catch (error) {
        console.error('Search error:', error);
        return [];
    }
}

// Advanced search with multiple criteria
function advancedSearch(data, searchTerm, searchFields) {
    return data.filter(item => {
        return searchFields.some(field => {
            const value = getNestedValue(item, field);
            if (typeof value === 'string') {
                return value.toLowerCase().includes(searchTerm.toLowerCase());
            } else if (typeof value === 'number') {
                return value.toString().includes(searchTerm);
            }
            return false;
        });
    });
}

// Helper function for nested properties
function getNestedValue(obj, path) {
    return path.split('.').reduce((current, key) => {
        return current ? current[key] : undefined;
    }, obj);
}

// Search with debouncing (for real-time search)
let searchTimeout;
document.getElementById('searchInput').addEventListener('input', function() {
    clearTimeout(searchTimeout);
    
    searchTimeout = setTimeout(() => {
        const term = this.value.trim();
        if (term.length >= 2) { // Minimum 2 characters
            performSearch(term);
        }
    }, 300); // Wait 300ms after typing stops
});

// Display search results
function displayResults(results) {
    const container = document.getElementById('results');
    
    if (results.length === 0) {
        container.innerHTML = '<p>No results found</p>';
        return;
    }
    
    container.innerHTML = \`
        <h3>Found \${results.length} results</h3>
        <ul>
            \${results.map(item => \`
                <li>
                    <h4>\${item.title}</h4>
                    <p>\${item.body.substring(0, 100)}...</p>
                </li>
            \`).join('')}
        </ul>
    \`;
}

// Sort search results
function sortResults(results, sortBy, sortOrder = 'asc') {
    return results.sort((a, b) => {
        let aValue = getNestedValue(a, sortBy);
        let bValue = getNestedValue(b, sortBy);
        
        if (typeof aValue === 'string') {
            aValue = aValue.toLowerCase();
            bValue = bValue.toLowerCase();
        }
        
        if (sortOrder === 'asc') {
            return aValue > bValue ? 1 : -1;
        } else {
            return aValue < bValue ? 1 : -1;
        }
    });
}

// Search statistics
function getSearchStats(results, totalItems) {
    return {
        found: results.length,
        total: totalItems,
        percentage: ((results.length / totalItems) * 100).toFixed(1) + '%',
        searchTime: new Date().toLocaleTimeString()
    };
}`;
    document.getElementById('code').style.display = 'block';
}
</script>
</body>
</html>