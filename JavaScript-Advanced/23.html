<!DOCTYPE html>
<html>
<head><title>Challenge 23: Filter Completed Todos</title></head>
<body>
<h1>Fetch and Filter Completed Todos</h1>
<button onclick="fetchTodos()">Fetch All Todos</button>
<button onclick="fetchCompleted()">Show Only Completed</button>
<button onclick="showCode()">Show Code</button>
<div id="result"></div>
<div id="code" style="display:none; background:#f5f5f5; padding:10px;"></div>
<script>
let allTodos = [];

async function fetchTodos() {
    try {
        const response = await fetch('https://jsonplaceholder.typicode.com/todos');
        allTodos = await response.json();
        displayTodos(allTodos, 'All Todos');
        console.log('Todos fetched:', allTodos.length);
    } catch (error) {
        document.getElementById('result').innerHTML = `Error: ${error.message}`;
    }
}

function fetchCompleted() {
    if (allTodos.length === 0) {
        alert('Fetch todos first');
        return;
    }
    
    const completed = allTodos.filter(todo => todo.completed);
    displayTodos(completed, 'Completed Todos');
    console.log('Completed todos:', completed.length);
}

function displayTodos(todos, title) {
    let result = `<h3>${title} (${todos.length})</h3>`;
    
    todos.forEach(todo => {
        const status = todo.completed ? '✅' : '❌';
        result += `
            <div style="border:1px solid #ddd; padding:10px; margin:5px; 
                       background:${todo.completed ? '#e8f5e9' : '#fff3e0'}">
                <strong>${todo.title}</strong><br>
                User: ${todo.userId} | Status: ${status} ${todo.completed ? 'Completed' : 'Pending'}
            </div>
        `;
    });
    
    document.getElementById('result').innerHTML = result;
}

function showCode() {
    document.getElementById('code').innerHTML = 
`// Fetch todos from API
async function fetchTodos() {
    const response = await fetch('https://jsonplaceholder.typicode.com/todos');
    const todos = await response.json();
    return todos;
}

// Filter completed todos
function getCompletedTodos(todos) {
    return todos.filter(todo => todo.completed === true);
}

// Filter pending todos
function getPendingTodos(todos) {
    return todos.filter(todo => todo.completed === false);
}

// Filter by user
function getTodosByUser(todos, userId) {
    return todos.filter(todo => todo.userId === userId);
}

// Example usage
async function displayCompleted() {
    const todos = await fetchTodos();
    const completed = getCompletedTodos(todos);
    
    console.log('Completed todos:', completed.length);
    console.log('First completed:', completed[0]);
    
    // Display in DOM
    const container = document.getElementById('result');
    container.innerHTML = '';
    
    completed.forEach(todo => {
        const div = document.createElement('div');
        div.textContent = \`\${todo.title} (User: \${todo.userId})\`;
        container.appendChild(div);
    });
}

// Statistics
function getTodoStats(todos) {
    return {
        total: todos.length,
        completed: todos.filter(t => t.completed).length,
        pending: todos.filter(t => !t.completed).length,
        completionRate: (todos.filter(t => t.completed).length / todos.length * 100).toFixed(1) + '%'
    };
}`;
    document.getElementById('code').style.display = 'block';
}
</script>
</body>
</html>