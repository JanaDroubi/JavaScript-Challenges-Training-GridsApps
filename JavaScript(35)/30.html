<!DOCTYPE html>
<html>
<head><title>Challenge 30: Create Table from JSON</title></head>
<body>
<h1>Fetch Products and Create Table</h1>
<button onclick="fetchProducts()">Fetch Products</button>
<button onclick="showCode()">Show Code</button>
<div id="tableContainer" style="margin:20px 0;"></div>
<div id="code" style="display:none; background:#f5f5f5; padding:10px;"></div>
<script>
async function fetchProducts() {
    try {
        // Using dummy JSON API for products
        const response = await fetch('https://dummyjson.com/products');
        const data = await response.json();
        const products = data.products.slice(0, 10); // First 10 products
        
        createProductTable(products);
        console.log('Products:', products);
        
    } catch (error) {
        // Fallback to local data if API fails
        console.log('API failed, using fallback data');
        const fallbackProducts = [
            {id: 1, title: "iPhone 9", price: 549, brand: "Apple", category: "smartphones"},
            {id: 2, title: "Samsung Universe 9", price: 1249, brand: "Samsung", category: "smartphones"},
            {id: 3, title: "OPPOF19", price: 280, brand: "OPPO", category: "smartphones"},
            {id: 4, title: "Huawei P30", price: 499, brand: "Huawei", category: "smartphones"}
        ];
        createProductTable(fallbackProducts);
    }
}

function createProductTable(products) {
    const container = document.getElementById('tableContainer');
    
    if (products.length === 0) {
        container.innerHTML = '<p>No products found</p>';
        return;
    }
    
    let tableHTML = `
        <h3>Products (${products.length})</h3>
        <table border="1" cellpadding="10" cellspacing="0" style="border-collapse:collapse; width:100%;">
            <thead style="background:#4CAF50; color:white;">
                <tr>
                    <th>ID</th>
                    <th>Product</th>
                    <th>Brand</th>
                    <th>Category</th>
                    <th>Price</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    let total = 0;
    
    products.forEach(product => {
        total += product.price || 0;
        
        tableHTML += `
            <tr style="${product.price > 500 ? 'background:#fff3e0' : ''}">
                <td>${product.id}</td>
                <td>${product.title || product.name}</td>
                <td>${product.brand || 'N/A'}</td>
                <td>${product.category || 'N/A'}</td>
                <td style="text-align:right;">$${product.price?.toFixed(2) || '0.00'}</td>
                <td>
                    <button onclick="viewProduct(${product.id})" style="padding:5px 10px; margin:2px;">View</button>
                    <button onclick="addToCart(${product.id})" style="padding:5px 10px; margin:2px; background:#4CAF50; color:white;">Add</button>
                </td>
            </tr>
        `;
    });
    
    const average = total / products.length;
    
    tableHTML += `
            </tbody>
            <tfoot style="background:#f5f5f5; font-weight:bold;">
                <tr>
                    <td colspan="4">Total Value:</td>
                    <td style="text-align:right;">$${total.toFixed(2)}</td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="4">Average Price:</td>
                    <td style="text-align:right;">$${average.toFixed(2)}</td>
                    <td></td>
                </tr>
            </tfoot>
        </table>
        <p style="margin-top:10px;">
            <strong>Stats:</strong> ${products.length} products | Total: $${total.toFixed(2)} | Average: $${average.toFixed(2)}
        </p>
    `;
    
    container.innerHTML = tableHTML;
}

function viewProduct(id) {
    alert(`Viewing product #${id}`);
}

function addToCart(id) {
    alert(`Product #${id} added to cart!`);
}

function showCode() {
    document.getElementById('code').innerHTML = 
`// Fetch products and create table
async function createProductTable() {
    try {
        const response = await fetch('https://dummyjson.com/products');
        const data = await response.json();
        const products = data.products.slice(0, 10);
        
        // Create table element
        const table = document.createElement('table');
        table.className = 'product-table';
        
        // Create header row
        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');
        
        const headers = ['ID', 'Product', 'Brand', 'Category', 'Price'];
        headers.forEach(headerText => {
            const th = document.createElement('th');
            th.textContent = headerText;
            headerRow.appendChild(th);
        });
        
        thead.appendChild(headerRow);
        table.appendChild(thead);
        
        // Create table body
        const tbody = document.createElement('tbody');
        
        products.forEach(product => {
            const row = document.createElement('tr');
            
            // ID cell
            const idCell = document.createElement('td');
            idCell.textContent = product.id;
            row.appendChild(idCell);
            
            // Product name cell
            const nameCell = document.createElement('td');
            nameCell.textContent = product.title;
            row.appendChild(nameCell);
            
            // Brand cell
            const brandCell = document.createElement('td');
            brandCell.textContent = product.brand;
            row.appendChild(brandCell);
            
            // Category cell
            const categoryCell = document.createElement('td');
            categoryCell.textContent = product.category;
            row.appendChild(categoryCell);
            
            // Price cell
            const priceCell = document.createElement('td');
            priceCell.textContent = \`$\${product.price.toFixed(2)}\`;
            priceCell.style.textAlign = 'right';
            row.appendChild(priceCell);
            
            tbody.appendChild(row);
        });
        
        table.appendChild(tbody);
        
        // Add table to container
        const container = document.getElementById('tableContainer');
        container.innerHTML = '';
        container.appendChild(table);
        
        return products;
        
    } catch (error) {
        console.error('Error creating product table:', error);
        return [];
    }
}

// Add CSS for better table styling
const style = document.createElement('style');
style.textContent = \`
.product-table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    font-family: Arial, sans-serif;
}

.product-table th {
    background-color: #4CAF50;
    color: white;
    padding: 12px;
    text-align: left;
}

.product-table td {
    padding: 10px;
    border-bottom: 1px solid #ddd;
}

.product-table tr:nth-child(even) {
    background-color: #f9f9f9;
}

.product-table tr:hover {
    background-color: #f5f5f5;
}

.product-table .price {
    text-align: right;
    font-weight: bold;
}

.product-table .expensive {
    background-color: #fff3e0;
}
\`;

document.head.appendChild(style);

// Sort table by column
function sortTable(columnIndex) {
    const table = document.querySelector('.product-table');
    const rows = Array.from(table.querySelectorAll('tbody tr'));
    
    rows.sort((a, b) => {
        const aText = a.children[columnIndex].textContent;
        const bText = b.children[columnIndex].textContent;
        
        // Handle numbers
        if (columnIndex === 4) { // Price column
            const aNum = parseFloat(aText.replace('$', ''));
            const bNum = parseFloat(bText.replace('$', ''));
            return aNum - bNum;
        }
        
        // Handle text
        return aText.localeCompare(bText);
    });
    
    // Reorder rows
    const tbody = table.querySelector('tbody');
    tbody.innerHTML = '';
    rows.forEach(row => tbody.appendChild(row));
}`;
    document.getElementById('code').style.display = 'block';
}
</script>
</body>
</html>