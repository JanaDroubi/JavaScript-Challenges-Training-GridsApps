<!DOCTYPE html>
<html>
<head><title>Challenge 33: Dashboard with JSON Settings</title></head>
<body>
<h1>Dashboard with JSON Settings</h1>
<button onclick="loadDashboard()">Load Dashboard</button>
<button onclick="saveSettings()">Save Settings</button>
<button onclick="resetDashboard()">Reset</button>
<div id="dashboard" style="margin:20px 0; padding:20px; background:#f5f5f5; display:none;">
    <div id="settingsDisplay"></div>
    <div id="widgets"></div>
</div>
<div id="code" style="display:none; background:#f5f5f5; padding:10px;"></div>
<script>
const defaultSettings = {
    theme: "light",
    language: "en",
    notifications: true,
    widgets: ["stats", "recent", "tasks"],
    refreshRate: 30
};

function loadDashboard() {
    // Try to load saved settings
    const saved = localStorage.getItem('dashboardSettings');
    const settings = saved ? JSON.parse(saved) : defaultSettings;
    
    // Apply theme
    document.body.style.backgroundColor = settings.theme === 'dark' ? '#333' : 'white';
    document.body.style.color = settings.theme === 'dark' ? 'white' : 'black';
    
    // Display settings
    document.getElementById('settingsDisplay').innerHTML = `
        <h3>Dashboard Settings</h3>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <div style="padding:10px; background:${settings.theme === 'dark' ? '#555' : '#e8e8e8'}">
                <strong>Theme:</strong> ${settings.theme}
            </div>
            <div style="padding:10px; background:${settings.theme === 'dark' ? '#555' : '#e8e8e8'}">
                <strong>Language:</strong> ${settings.language}
            </div>
            <div style="padding:10px; background:${settings.theme === 'dark' ? '#555' : '#e8e8e8'}">
                <strong>Notifications:</strong> ${settings.notifications ? 'On' : 'Off'}
            </div>
            <div style="padding:10px; background:${settings.theme === 'dark' ? '#555' : '#e8e8e8'}">
                <strong>Refresh Rate:</strong> ${settings.refreshRate}s
            </div>
        </div>
    `;
    
    // Create widgets based on settings
    createWidgets(settings);
    
    // Show dashboard
    document.getElementById('dashboard').style.display = 'block';
    
    console.log('Dashboard loaded with settings:', settings);
}

function createWidgets(settings) {
    const widgetsContainer = document.getElementById('widgets');
    widgetsContainer.innerHTML = '<h3>Widgets:</h3>';
    
    settings.widgets.forEach(widget => {
        const widgetDiv = document.createElement('div');
        widgetDiv.style.cssText = `
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            background: ${settings.theme === 'dark' ? '#444' : 'white'};
        `;
        
        switch(widget) {
            case 'stats':
                widgetDiv.innerHTML = `
                    <h4>ðŸ“Š Statistics Widget</h4>
                    <p>Settings loaded from localStorage</p>
                    <ul>
                        <li>Theme: ${settings.theme}</li>
                        <li>Language: ${settings.language}</li>
                        <li>Last updated: ${new Date().toLocaleTimeString()}</li>
                    </ul>
                `;
                break;
            case 'recent':
                widgetDiv.innerHTML = `
                    <h4>ðŸ•’ Recent Activity</h4>
                    <ul>
                        <li>Dashboard loaded</li>
                        <li>Settings applied</li>
                        <li>Theme: ${settings.theme}</li>
                    </ul>
                `;
                break;
            case 'tasks':
                widgetDiv.innerHTML = `
                    <h4>âœ… Tasks</h4>
                    <ul>
                        <li>Configure settings âœ“</li>
                        <li>Load widgets âœ“</li>
                        <li>Apply theme âœ“</li>
                    </ul>
                `;
                break;
        }
        
        widgetsContainer.appendChild(widgetDiv);
    });
}

function saveSettings() {
    const newSettings = {
        theme: prompt('Enter theme (light/dark):', 'light'),
        language: prompt('Enter language (en/es/fr):', 'en'),
        notifications: confirm('Enable notifications?'),
        widgets: ['stats', 'recent', 'tasks'],
        refreshRate: parseInt(prompt('Refresh rate (seconds):', '30'))
    };
    
    // Validate
    if (!newSettings.theme || !newSettings.language || isNaN(newSettings.refreshRate)) {
        alert('Invalid settings');
        return;
    }
    
    // Save to localStorage
    localStorage.setItem('dashboardSettings', JSON.stringify(newSettings));
    alert('Settings saved! Reloading dashboard...');
    loadDashboard();
}

function resetDashboard() {
    if (confirm('Reset to default settings?')) {
        localStorage.removeItem('dashboardSettings');
        document.getElementById('dashboard').style.display = 'none';
        document.body.style.backgroundColor = '';
        document.body.style.color = '';
        alert('Dashboard reset');
    }
}

function showCode() {
    document.getElementById('code').innerHTML = 
`// Dashboard with JSON settings from localStorage
const defaultSettings = {
    theme: "light",
    language: "en",
    notifications: true,
    widgets: ["stats", "calendar"],
    refreshRate: 30
};

// Load dashboard
function loadDashboard() {
    // Get settings from localStorage or use defaults
    const saved = localStorage.getItem('dashboardSettings');
    const settings = saved ? JSON.parse(saved) : defaultSettings;
    
    // Apply settings
    applyTheme(settings.theme);
    applyLanguage(settings.language);
    createWidgets(settings.widgets);
    
    console.log('Dashboard loaded with:', settings);
}

// Save settings
function saveSettings(newSettings) {
    // Validate
    if (!isValidSettings(newSettings)) {
        alert('Invalid settings');
        return;
    }
    
    // Save to localStorage
    localStorage.setItem('dashboardSettings', JSON.stringify(newSettings));
    
    // Reload dashboard
    loadDashboard();
}

// Apply theme
function applyTheme(theme) {
    document.body.className = theme + '-theme';
    
    // Or set CSS variables
    document.documentElement.style.setProperty('--primary-color', 
        theme === 'dark' ? '#333' : '#fff');
    document.documentElement.style.setProperty('--text-color',
        theme === 'dark' ? '#fff' : '#333');
}

// Create widgets dynamically
function createWidgets(widgetList) {
    const container = document.getElementById('widgets');
    container.innerHTML = '';
    
    widgetList.forEach(widgetName => {
        const widget = createWidget(widgetName);
        container.appendChild(widget);
    });
}

// Widget factory
function createWidget(name) {
    const widget = document.createElement('div');
    widget.className = 'widget';
    
    switch(name) {
        case 'stats':
            widget.innerHTML = \`
                <h3>Statistics</h3>
                <div>Users: 100</div>
                <div>Posts: 500</div>
            \`;
            break;
        case 'calendar':
            widget.innerHTML = \`
                <h3>Calendar</h3>
                <div>\${new Date().toDateString()}</div>
            \`;
            break;
    }
    
    return widget;
}

// Settings form
document.getElementById('settingsForm').addEventListener('submit', (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const settings = {
        theme: formData.get('theme'),
        language: formData.get('language'),
        notifications: formData.get('notifications') === 'on',
        widgets: formData.getAll('widgets'),
        refreshRate: parseInt(formData.get('refreshRate'))
    };
    
    saveSettings(settings);
});

// Auto-save on change
document.querySelectorAll('.setting-input').forEach(input => {
    input.addEventListener('change', () => {
        const settings = getCurrentSettings();
        saveSettings(settings);
    });
});`;
    document.getElementById('code').style.display = 'block';
}
</script>
</body>
</html>