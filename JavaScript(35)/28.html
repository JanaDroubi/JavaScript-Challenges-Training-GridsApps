<!DOCTYPE html>
<html>
<head><title>Challenge 28: Fetch on Button Click</title></head>
<body>
<h1>Fetch JSON on Button Click</h1>
<button onclick="fetchAlbums()">Fetch Albums</button>
<button onclick="fetchPosts()">Fetch Posts</button>
<button onclick="fetchTodos()">Fetch Todos</button>
<button onclick="clearDisplay()">Clear</button>
<button onclick="showCode()">Show Code</button>
<pre id="jsonDisplay" style="background:#f5f5f5; padding:15px; max-height:400px; overflow:auto;"></pre>
<div id="code" style="display:none; background:#f5f5f5; padding:10px;"></div>
<script>
async function fetchAlbums() {
    try {
        const response = await fetch('https://jsonplaceholder.typicode.com/albums');
        const albums = await response.json();
        displayJSON(albums.slice(0, 3), 'Albums');
        console.log('Albums:', albums);
    } catch (error) {
        alert(`Error: ${error.message}`);
    }
}

async function fetchPosts() {
    try {
        const response = await fetch('https://jsonplaceholder.typicode.com/posts');
        const posts = await response.json();
        displayJSON(posts.slice(0, 3), 'Posts');
        console.log('Posts:', posts);
    } catch (error) {
        alert(`Error: ${error.message}`);
    }
}

async function fetchTodos() {
    try {
        const response = await fetch('https://jsonplaceholder.typicode.com/todos');
        const todos = await response.json();
        displayJSON(todos.slice(0, 3), 'Todos');
        console.log('Todos:', todos);
    } catch (error) {
        alert(`Error: ${error.message}`);
    }
}

function displayJSON(data, title) {
    const display = document.getElementById('jsonDisplay');
    display.innerHTML = `<strong>${title} (showing 3 items):</strong>\n${JSON.stringify(data, null, 2)}`;
}

function clearDisplay() {
    document.getElementById('jsonDisplay').innerHTML = '';
}

function showCode() {
    document.getElementById('code').innerHTML = 
`// Fetch JSON on button click
document.getElementById('fetchBtn').addEventListener('click', async () => {
    try {
        // Show loading state
        document.getElementById('result').textContent = 'Loading...';
        
        // Fetch data
        const response = await fetch('https://jsonplaceholder.typicode.com/posts');
        const data = await response.json();
        
        // Display in <pre> tag with formatting
        document.getElementById('result').textContent = JSON.stringify(data, null, 2);
        
        console.log('Data fetched:', data);
        
    } catch (error) {
        document.getElementById('result').textContent = \`Error: \${error.message}\`;
        console.error('Fetch error:', error);
    }
});

// Multiple fetch buttons
document.querySelectorAll('.fetch-btn').forEach(button => {
    button.addEventListener('click', async (event) => {
        const endpoint = event.target.dataset.endpoint;
        const url = \`https://jsonplaceholder.typicode.com/\${endpoint}\`;
        
        try {
            const response = await fetch(url);
            const data = await response.json();
            displayData(data, endpoint);
        } catch (error) {
            console.error(\`Error fetching \${endpoint}:\`, error);
        }
    });
});

// Display function
function displayData(data, type) {
    const pre = document.getElementById('jsonDisplay');
    
    // Limit data if too large
    const displayData = Array.isArray(data) ? data.slice(0, 5) : data;
    
    pre.innerHTML = \`
        <strong>\${type.toUpperCase()} (first \${Array.isArray(displayData) ? displayData.length : 1} items):</strong>
        \${JSON.stringify(displayData, null, 2)}
    \`;
}

// Clear button
document.getElementById('clearBtn').addEventListener('click', () => {
    document.getElementById('jsonDisplay').textContent = '';
});

// Auto-refresh button
let refreshInterval;
document.getElementById('autoRefreshBtn').addEventListener('click', () => {
    if (!refreshInterval) {
        refreshInterval = setInterval(fetchData, 5000); // Every 5 seconds
        document.getElementById('autoRefreshBtn').textContent = 'Stop Auto-Refresh';
    } else {
        clearInterval(refreshInterval);
        refreshInterval = null;
        document.getElementById('autoRefreshBtn').textContent = 'Start Auto-Refresh';
    }
});`;
    document.getElementById('code').style.display = 'block';
}
</script>
</body>
</html>